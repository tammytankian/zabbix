zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: c2c162144c2d4c5491c8801193af4945
      name: Templates/Cloud
  templates:
    - uuid: 3399b5fbe4474c138291ef4f6f0c2a76
      template: 'Azure Web Apps by HTTP'
      name: 'Azure Web Apps by HTTP'
      description: 'Custom template to collect metrics related to Azure Web Apps (App Service) using HTTP agent, adapted from Zabbix official templates'
      vendor:
        name: 'TammyT Custom Template'
        version: 7.0-0
      groups:
        - name: Templates/Cloud
      items:
        - uuid: da5a311a05524d9ca7c7e10e7eff60fa
          name: 'Number of Bound Sockets'
          type: DEPENDENT
          key: azure.wapp.appconnections.average
          delay: '0'
          history: 7d
          description: 'The number of bound sockets existing in the sandbox (w3wp.exe and its child processes). A bound socket is created by calling bind()/connect() APIs and remains until said socket is closed with CloseHandle()/closesocket().'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.AppConnections.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 386d0c6b69184442824e41d242a97e96
          name: 'Resource Availability Detailed'
          type: DEPENDENT
          key: azure.wapp.availability.details
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          description: 'The summary description of availability status.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.health.summary
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: health
        - uuid: 5bd3e9b07f5d4d57bf4fc65428c91f34
          name: 'Average memory working set'
          type: DEPENDENT
          key: azure.wapp.averagememoryworkingset.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: B
          description: 'The average amount of memory used by the app, in megabytes (MiB)'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.AverageMemoryWorkingSet.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: memory
        - uuid: 954c19bfb815443a9f4f39a5690830b1
          name: 'Average Response Time (deprecated)'
          type: DEPENDENT
          key: azure.wapp.averageresponsetime.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: s
          description: 'The average time taken for the app to serve requests, in seconds'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.AverageResponseTime.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 50093e0a23f94a7b875938b42b4e8b9a
          name: 'Data In Total'
          type: DEPENDENT
          key: azure.wapp.bytesreceived.total
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: Bps
          description: 'The amount of incoming bandwidth consumed by the app, in MiB'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.BytesReceived.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: network
        - uuid: 02449093d75f4e0c8ee5c5324bfff639
          name: 'Data Out Total'
          type: DEPENDENT
          key: azure.wapp.bytessent.total
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: Bps
          description: 'The amount of outgoing bandwidth consumed by the app, in MiB'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.BytesSent.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: network
        - uuid: 196fe6c4a13849cb89f2331a9735805b
          name: 'CPU Time'
          type: DEPENDENT
          key: azure.wapp.cputime.total
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: s
          description: 'The amount of CPU consumed by the app, in seconds.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.CpuTime.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: 5cad69a3f4e24b2fa18d82bb2fc7f228
              expression: 'min(/Azure Web Apps by HTTP - Reviewed/azure.wapp.cputime.total,15m)>={$WAPP_CPU}'
              name: 'CPU usage for Web App is too high'
              priority: WARNING
              manual_close: 'YES'
        - uuid: c72da6c1794944c695e37dff1621cb6e
          name: 'Current Assemblies'
          type: DEPENDENT
          key: azure.wapp.currentassemblies.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The current number of Assemblies loaded across all AppDomains in this application'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.CurrentAssemblies.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'app domain'
        - uuid: 7648dced63db42558fdbb168eb170732
          name: 'Get data'
          type: SCRIPT
          key: azure.wapp.data.get
          delay: 1h
          history: '0'
          trends: '0'
          value_type: TEXT
          params: |
            var AzureWApp = {
            	params: {},
            	token: null,
            
            	setParams: function (params) {
            		['app_id', 'password', 'tenant_id', 'subscription_id', 'resource_id'].forEach(function (field) {
            			if (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {
            				throw 'Required param is not set: ' + field + '.';
            			}
            		});
            
            		AzureWApp.params = params;
            	},
            
            
            	request: function (url, data) {
            		if (typeof data === 'undefined' || data === null) {
            			data = '';
            		}
            
            		var response, request = new HttpRequest();
            		if (typeof AzureWApp.params.proxy !== 'undefined' && AzureWApp.params.proxy !== '') {
            			request.setProxy(AzureWApp.params.proxy);
            		}
            		if (AzureWApp.token) {
            			request.addHeader('Accept: application/json');
            			request.addHeader('Authorization: Bearer ' + AzureWApp.token);
            		}
            
            		Zabbix.log(4, '[ Azure ] Sending request: ' + url);
            
            		if (data !== '') {
            			request.addHeader('Content-Type: application/x-www-form-urlencoded');
            			response = request.post(url, data);
            		}
            		else {
            			response = request.get(url);
            		}
            
            		Zabbix.log(4, '[ Azure ] Received response with status code ' + request.getStatus() + ': ' + response);
            
            		if (request.getStatus() !== 200 || response === null) {
            			throw 'Request failed with status code ' + request.getStatus() + ': ' + response;
            		}
            
            		try {
            			return JSON.parse(response);
            		}
            		catch (error) {
            			throw 'Failed to parse response received from API.';
            		}
            	}
            
            };
            
            var metrics = [ 
            
            //metrics chosen from official documentation - https://learn.microsoft.com/en-us/azure/azure-monitor/reference/supported-metrics/microsoft-web-sites-metrics
            
            	'AppConnections',
            	'AverageMemoryWorkingSet',
            	'AverageResponseTime', //deprecated
            	'BytesReceived',
            	'BytesSent',
            	'CpuTime',
            	'CurrentAssemblies',
            	'FileSystemUsage',
            	'Gen0Collections',
            	'Gen1Collections',
            	'Gen2Collections',
            	'Handles',
            	'HealthCheckStatus',
            	'Http101',
            	'Http2xx',
            	'Http3xx',
            	'Http401',
            	'Http403',
            	'Http404',
            	'Http406',
            	'Http4xx',
            	'Http5xx',
            	'HttpResponseTime',
            //	'InstanceCount',
            	'IoOtherBytesPerSecond',
            	'IoOtherOperationsPerSecond',
            	'IoReadBytesPerSecond',
            	'IoReadOperationsPerSecond',
            	'IoWriteBytesPerSecond',
            	'IoWriteOperationsPerSecond',
            	'MemoryWorkingSet',
            	'PrivateBytes',
            	'Requests',
            	'RequestsInApplicationQueue',
            	'Threads',
            	'TotalAppDomains',
            	'TotalAppDomainsUnloaded'						 
            ],
            	//day_metrics = 'full_backup_size_bytes,diff_backup_size_bytes,log_backup_size_bytes',
            	prepared_metrics = [],
            	data = {};
            	data['errors'] = {};
            	data['metrics'] = {};
            
            try {
            	AzureWApp.setParams(JSON.parse(value));
            
            	try {
            		result = AzureWApp.request(
            			'https://login.microsoftonline.com/' + encodeURIComponent(AzureWApp.params.tenant_id) + '/oauth2/token',
            			'grant_type=client_credentials&resource=' + encodeURIComponent('https://management.azure.com/') + '&client_id=' + encodeURIComponent(AzureWApp.params.app_id) + '&client_secret=' + encodeURIComponent(AzureWApp.params.password)
            		);
            
            		if ('access_token' in result) {
            			AzureWApp.token = result['access_token'];
            		} else {
            			throw 'Auth response does not contain access token.';
            		}
            	}
            	catch (error) {
            		data.errors.auth = error.toString();
            	}
            
            	if (!('auth' in data.errors)) {
            		try {
            			health = AzureWApp.request('https://management.azure.com' + AzureWApp.params.resource_id + '/providers/Microsoft.ResourceHealth/availabilityStatuses?api-version=2020-05-01');
            			if ('value' in health && Array.isArray(health.value) && health.value.length > 0 && 'properties' in health.value[0] && typeof health.value[0].properties === 'object') {
            				data.health = health.value[0].properties;
            			}
            		}
            		catch (error) {
            			data.errors.health = error.toString();
            		}
            
            		for (var i = 0; i < metrics.length; i += 20) {
            			var chunk = metrics.slice(i, i + 20);
            
            			prepared_metrics.push(
            				chunk.map(function (element) {
            					return encodeURIComponent(element);
            				}).join(',')
            			);
            		}
            
            		start_date = new Date((new Date().getTime()) - 300000).toISOString().replace(/\.\d+/, '');
            		end_date = new Date().toISOString().replace(/\.\d+/, '');
            
            		for (var j in prepared_metrics) {
            			try {
            				metrics_data = AzureWApp.request('https://management.azure.com' + AzureWApp.params.resource_id + '/providers/Microsoft.Insights/metrics?metricnames=' + prepared_metrics[j] + '&timespan=' + encodeURIComponent(start_date) + '/' + encodeURIComponent(end_date) + '&api-version=2021-05-01');
            				if ('value' in metrics_data && Array.isArray(metrics_data.value) && metrics_data.value.length > 0) {
            					for (k in metrics_data.value) {
            						if ('name' in metrics_data.value[k] && typeof metrics_data.value[k].name === 'object' && 'value' in metrics_data.value[k].name && typeof metrics_data.value[k].name.value === 'string' && 'timeseries' in metrics_data.value[k] && Array.isArray(metrics_data.value[k].timeseries) && metrics_data.value[k].timeseries.length > 0 && 'data' in metrics_data.value[k].timeseries[0] && Array.isArray(metrics_data.value[k].timeseries[0].data) && metrics_data.value[k].timeseries[0].data.length > 0) {
            							data.metrics[metrics_data.value[k].name.value.replace(/(\s|\/)+/g, '')] = metrics_data.value[k].timeseries[0].data[metrics_data.value[k].timeseries[0].data.length - 1];
            						}
            					}
            				}
            			}
            			catch (error) {
            				data.errors[prepared_metrics[j]] = error.toString();
            			}
            		}
            		// start_date = new Date((new Date().getTime()) - 86400000).toISOString().replace(/\.\d+/, '');
            		// end_date = new Date().toISOString().replace(/\.\d+/, '');
            		// try {
            			// metrics_data = AzureWApp.request('https://management.azure.com' + AzureWApp.params.resource_id + '/providers/Microsoft.Insights/metrics?metricnames=' + day_metrics + '&timespan=' + encodeURIComponent(start_date) + '/' + encodeURIComponent(end_date) + '&api-version=2021-05-01');
            			// if ('value' in metrics_data && Array.isArray(metrics_data.value) && metrics_data.value.length > 0) {
            				// for (l in metrics_data.value) {
            					// if ('name' in metrics_data.value[l] && typeof metrics_data.value[l].name === 'object' && 'value' in metrics_data.value[l].name && typeof metrics_data.value[l].name.value === 'string' && 'timeseries' in metrics_data.value[l] && Array.isArray(metrics_data.value[l].timeseries) && metrics_data.value[l].timeseries.length > 0 && 'data' in metrics_data.value[l].timeseries[0] && Array.isArray(metrics_data.value[l].timeseries[0].data) && metrics_data.value[l].timeseries[0].data.length > 0) {
            						// data.metrics[metrics_data.value[l].name.value.replace(/(\s|\/)+/g, '')] = metrics_data.value[l].timeseries[0].data[metrics_data.value[l].timeseries[0].data.length - 1];
            					// }
            				// }
            			// }
            		// }
            		// catch (error) {
            			// data.errors[day_metrics] = error.toString();
            		// }
            	}
            }
            catch (error) {
            	data.errors.params = error.toString();
            }
            
            if (Object.keys(data.errors).length !== 0) {
            	errors = 'Failed to receive data:';
            	for (var error in data.errors) {
            		errors += '\n' + error + ' : ' + data.errors[error];
            	}
            	data.errors = errors;
            }
            else {
            	data.errors = '';
            }
            
            return JSON.stringify(data);
          description: 'The result of API requests is expressed in the JSON.'
          timeout: '{$AZURE.DATA.TIMEOUT}'
          parameters:
            - name: app_id
              value: '{$AZURE.APP.ID}'
            - name: password
              value: '{$AZURE.PASSWORD}'
            - name: proxy
              value: '{$AZURE.PROXY}'
            - name: resource_id
              value: '{$AZURE.RESOURCE.ID}'
            - name: subscription_id
              value: '{$AZURE.SUBSCRIPTION.ID}'
            - name: tenant_id
              value: '{$AZURE.TENANT.ID}'
          tags:
            - tag: component
              value: 'api request'
        - uuid: 9a98ab9ba3c8448c8bb783c3a0998332
          name: 'Get errors'
          type: DEPENDENT
          key: azure.wapp.errors
          delay: '0'
          history: 7d
          trends: '0'
          value_type: TEXT
          description: 'A list of errors from API requests.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.errors
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'api request'
          triggers:
            - uuid: 16674a49094c4531a83311480b432cef
              expression: 'length(last(/Azure Web Apps by HTTP - Reviewed/azure.wapp.errors))>0'
              name: 'Zabbix was unable to collect API data'
              opdata: '{ITEM.LASTVALUE1}'
              priority: AVERAGE
              description: 'Zabbix has received errors in response to API requests.'
              tags:
                - tag: scope
                  value: availability
        - uuid: 8441227ad9e14dbdaccaea31917cce41
          name: 'File System Usage'
          type: DEPENDENT
          key: azure.wapp.filesystemusage.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: '%'
          description: 'Percentage of filesystem quota consumed by the app'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.FileSystemUsage.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'file system'
        - uuid: 44d95775e0184174a2fafe087a905301
          name: 'Gen 0 Garbage Collections'
          type: DEPENDENT
          key: azure.wapp.gen0collections.total
          delay: '0'
          history: 7d
          description: 'The number of times the generation 0 objects are garbage collected since the start of the app process'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Gen0Collections.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: b17551c7cc8841d2a080a70f3cfcec41
          name: 'Gen 1 Garbage Collections'
          type: DEPENDENT
          key: azure.wapp.gen1collections.total
          delay: '0'
          history: 7d
          description: 'The number of times the generation 1 objects are garbage collected since the start of the app process.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Gen1Collections.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 7cf8e5d79daa48c9b34c14a4114c28e1
          name: 'Gen 2 Garbage Collections'
          type: DEPENDENT
          key: azure.wapp.gen2collections.total
          delay: '0'
          history: 7d
          description: 'The number of times the generation 2 objects are garbage collected since the start of the app process'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Gen2Collections.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 9da91eb693d24624a63be5c1c2f84ec6
          name: 'Handle Count'
          type: DEPENDENT
          key: azure.wapp.handles.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The total number of handles currently open by the app process'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Handles.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 70fe7ebc8305445594400df2e6f247c1
          name: 'Resource Availability'
          type: DEPENDENT
          key: azure.wapp.health.availability
          delay: '0'
          history: 7d
          trends: '0'
          description: 'The availability status of the resource.'
          valuemap:
            name: 'Azure resource health state'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.health.availabilityState
              error_handler: CUSTOM_VALUE
              error_handler_params: '3'
            - type: STR_REPLACE
              parameters:
                - Available
                - '0'
            - type: STR_REPLACE
              parameters:
                - Degraded
                - '1'
            - type: STR_REPLACE
              parameters:
                - Unavailable
                - '2'
            - type: STR_REPLACE
              parameters:
                - Unknown
                - '3'
            - type: IN_RANGE
              parameters:
                - '0'
                - '3'
              error_handler: CUSTOM_VALUE
              error_handler_params: '3'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: health
        - uuid: 5348f31befa94400a55e82c746939c72
          name: 'Http 2xx Requests'
          type: DEPENDENT
          key: azure.wapp.http2xx.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in an HTTP status code >= 200 but < 300
            
            Meaning of each 2xx code:
            :-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:
            200 OK
            The request succeeded. The result meaning of "success" depends on the HTTP method:
            
            GET: The resource has been fetched and transmitted in the message body.
            ---
            HEAD: The representation headers are included in the response without any message body.
            ---
            PUT or POST: The resource describing the result of the action is transmitted in the message body.
            ---
            TRACE: The message body contains the request message as received by the server.
            -----------------------
            201 Created
            The request succeeded, and a new resource was created as a result. This is typically the response sent after POST requests, or some PUT requests.
            -----------------------
            202 Accepted
            The request has been received but not yet acted upon. It is noncommittal, since there is no way in HTTP to later send an asynchronous response indicating the outcome of the request. It is intended for cases where another process or server handles the request, or for batch processing.
            -----------------------
            203 Non-Authoritative Information
            This response code means the returned metadata is not exactly the same as is available from the origin server, but is collected from a local or a third-party copy. This is mostly used for mirrors or backups of another resource. Except for that specific case, the 200 OK response is preferred to this status.
            -----------------------
            204 No Content
            There is no content to send for this request, but the headers may be useful. The user agent may update its cached headers for this resource with the new ones.
            -----------------------
            205 Reset Content
            Tells the user agent to reset the document which sent this request.
            -----------------------
            206 Partial Content
            This response code is used when the Range header is sent from the client to request only part of a resource.
            -----------------------
            226 IM Used (HTTP Delta encoding)
            The server has fulfilled a GET request for the resource, and the response is a representation of the result of one or more instance-manipulations applied to the current instance.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http2xx.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: e671d12ae60c4bd0a08cb111bdfc4bd3
          name: 'Http 3xx Requests'
          type: DEPENDENT
          key: azure.wapp.http3xx.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in an HTTP status code >= 300 but < 400
            
            Meaning of each 3xx code:
            :-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:
            300 Multiple Choices
            The request has more than one possible response. The user agent or user should choose one of them. 
            -------------------------
            301 Moved Permanently
            The URL of the requested resource has been changed permanently. The new URL is given in the response.
            -------------------------
            302 Found
            This response code means that the URI of requested resource has been changed temporarily. Further changes in the URI might be made in the future. Therefore, this same URI should be used by the client in future requests.
            -------------------------
            303 See Other
            The server sent this response to direct the client to get the requested resource at another URI with a GET request.
            -------------------------
            304 Not Modified
            This is used for caching purposes. It tells the client that the response has not been modified, so the client can continue to use the same cached version of the response.
            -------------------------
            307 Temporary Redirect
            The server sends this response to direct the client to get the requested resource at another URI with the same method that was used in the prior request. This has the same semantics as the 302 Found HTTP response code, with the exception that the user agent must not change the HTTP method used: if a POST was used in the first request, a POST must be used in the second request.
            -------------------------
            308 Permanent Redirect
            This means that the resource is now permanently located at another URI, specified by the Location: HTTP Response header. This has the same semantics as the 301 Moved Permanently HTTP response code, with the exception that the user agent must not change the HTTP method used: if a POST was used in the first request, a POST must be used in the second request.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http3xx.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: a9aeb79e57ec4b1591913fcbc3e6d828
          name: 'Http 4xx Requests'
          type: DEPENDENT
          key: azure.wapp.http4xx.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in an HTTP status code >= 400 but < 500
            
            Meaning of each 4xx code:
            :-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:
            400 Bad Request
            The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).
            -----------------------------------
            401 Unauthorized
            Although the HTTP standard specifies "unauthorized", semantically this response means "unauthenticated". That is, the client must authenticate itself to get the requested response.
            -----------------------------------
            403 Forbidden
            The client does not have access rights to the content; that is, it is unauthorized, so the server is refusing to give the requested resource. Unlike 401 Unauthorized, the client's identity is known to the server.
            -----------------------------------
            404 Not Found
            The server cannot find the requested resource. In the browser, this means the URL is not recognized. In an API, this can also mean that the endpoint is valid but the resource itself does not exist. Servers may also send this response instead of 403 Forbidden to hide the existence of a resource from an unauthorized client. This response code is probably the most well known due to its frequent occurrence on the web.
            -----------------------------------
            405 Method Not Allowed
            The request method is known by the server but is not supported by the target resource. For example, an API may not allow calling DELETE to remove a resource.
            -----------------------------------
            406 Not Acceptable
            This response is sent when the web server, after performing server-driven content negotiation, doesn't find any content that conforms to the criteria given by the user agent.
            -----------------------------------
            407 Proxy Authentication Required
            This is similar to 401 Unauthorized but authentication is needed to be done by a proxy.
            -----------------------------------
            408 Request Timeout
            This response is sent on an idle connection by some servers, even without any previous request by the client. It means that the server would like to shut down this unused connection. This response is used much more since some browsers, like Chrome, Firefox 27+, or IE9, use HTTP pre-connection mechanisms to speed up surfing. Also note that some servers merely shut down the connection without sending this message.
            -----------------------------------
            409 Conflict
            This response is sent when a request conflicts with the current state of the server.
            -----------------------------------
            410 Gone
            This response is sent when the requested content has been permanently deleted from server, with no forwarding address. Clients are expected to remove their caches and links to the resource. The HTTP specification intends this status code to be used for "limited-time, promotional services". APIs should not feel compelled to indicate resources that have been deleted with this status code.
            -----------------------------------
            411 Length Required
            Server rejected the request because the Content-Length header field is not defined and the server requires it.
            -----------------------------------
            412 Precondition Failed
            The client has indicated preconditions in its headers which the server does not meet.
            -----------------------------------
            413 Payload Too Large
            Request entity is larger than limits defined by server. The server might close the connection or return an Retry-After header field.
            -----------------------------------
            414 URI Too Long
            The URI requested by the client is longer than the server is willing to interpret.
            -----------------------------------
            415 Unsupported Media Type
            The media format of the requested data is not supported by the server, so the server is rejecting the request.
            -----------------------------------
            416 Range Not Satisfiable
            The range specified by the Range header field in the request cannot be fulfilled. It's possible that the range is outside the size of the target URI's data.
            -----------------------------------
            417 Expectation Failed
            This response code means the expectation indicated by the Expect request header field cannot be met by the server.
            -----------------------------------
            421 Misdirected Request
            The request was directed at a server that is not able to produce a response. This can be sent by a server that is not configured to produce responses for the combination of scheme and authority that are included in the request URI.
            -----------------------------------
            426 Upgrade Required
            The server refuses to perform the request using the current protocol but might be willing to do so after the client upgrades to a different protocol. The server sends an Upgrade header in a 426 response to indicate the required protocol(s).
            -----------------------------------
            428 Precondition Required
            The origin server requires the request to be conditional. This response is intended to prevent the 'lost update' problem, where a client GETs a resource's state, modifies it and PUTs it back to the server, when meanwhile a third party has modified the state on the server, leading to a conflict.
            -----------------------------------
            429 Too Many Requests
            The user has sent too many requests in a given amount of time ("rate limiting").
            -----------------------------------
            431 Request Header Fields Too Large
            The server is unwilling to process the request because its header fields are too large. The request may be resubmitted after reducing the size of the request header fields.
            -----------------------------------
            451 Unavailable For Legal Reasons
            The user agent requested a resource that cannot legally be provided, such as a web page censored by a government.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http4xx.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: b40b913cf78644e29631d81deb89c11c
          name: 'Http Server Errors'
          type: DEPENDENT
          key: azure.wapp.http5xx.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in an HTTP status code >= 500 but < 600
            
            Meaning of each 5xx code:
            :-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:-:
            500 Internal Server Error
            The server has encountered a situation it does not know how to handle.
            --------------------------------------
            501 Not Implemented
            The request method is not supported by the server and cannot be handled. The only methods that servers are required to support (and therefore that must not return this code) are GET and HEAD.
            --------------------------------------
            502 Bad Gateway
            This error response means that the server, while working as a gateway to get a response needed to handle the request, got an invalid response.
            --------------------------------------
            503 Service Unavailable
            The server is not ready to handle the request. Common causes are a server that is down for maintenance or that is overloaded. Note that together with this response, a user-friendly page explaining the problem should be sent. This response should be used for temporary conditions and the Retry-After HTTP header should, if possible, contain the estimated time before the recovery of the service. The webmaster must also take care about the caching-related headers that are sent along with this response, as these temporary condition responses should usually not be cached.
            --------------------------------------
            504 Gateway Timeout
            This error response is given when the server is acting as a gateway and cannot get a response in time.
            --------------------------------------
            505 HTTP Version Not Supported
            The HTTP version used in the request is not supported by the server.
            --------------------------------------
            506 Variant Also Negotiates
            The server has an internal configuration error: the chosen variant resource is configured to engage in transparent content negotiation itself, and is therefore not a proper end point in the negotiation process.
            --------------------------------------
            510 Not Extended
            Further extensions to the request are required for the server to fulfill it.
            --------------------------------------
            511 Network Authentication Required
            Indicates that the client needs to authenticate to gain network access.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http5xx.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
          triggers:
            - uuid: ba5b1f24cca24af98096e0bb683348e7
              expression: 'min(/Azure Web Apps by HTTP - Reviewed/azure.wapp.http5xx.total,30m)>={$WAPP_ERRORS}'
              name: 'Web App has a high number of Server Errors (HTTP 5xx)'
              priority: WARNING
              manual_close: 'YES'
              tags:
                - tag: component
                  value: http
        - uuid: e95ea0b26ad54f75b1ae301a21452d28
          name: 'Http 101 Requests'
          type: DEPENDENT
          key: azure.wapp.http101.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in an HTTP status code 101
            
            This code is sent in response to an Upgrade request header from the client and indicates the protocol the server is switching to.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http101.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: 55d508ce11a44b8198c1574c45ee3d69
          name: 'Http 401 Requests'
          type: DEPENDENT
          key: azure.wapp.http401.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in HTTP 401 status code
            
            Although the HTTP standard specifies "unauthorized", semantically this response means "unauthenticated". That is, the client must authenticate itself to get the requested response.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http401.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: 67393884bb1b4986b498db43d57a88cf
          name: 'Http 403 Requests'
          type: DEPENDENT
          key: azure.wapp.http403.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in HTTP 403 status code
            
            The client does not have access rights to the content; that is, it is unauthorized, so the server is refusing to give the requested resource. Unlike 401 Unauthorized, the client's identity is known to the server.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http403.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: 9efe94b5724b453f9560642098a85f68
          name: 'Http 406 Requests'
          type: DEPENDENT
          key: azure.wapp.http406.total
          delay: '0'
          history: 7d
          description: |
            The count of requests resulting in HTTP 406 status code
            
            This response is sent when the web server, after performing server-driven content negotiation, doesn't find any content that conforms to the criteria given by the user agent.
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Http406.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'http request'
        - uuid: dde0a3a13a334d41a029b1d50d4796c8
          name: 'Response Time'
          type: DEPENDENT
          key: azure.wapp.httpresponsetime.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: s
          description: 'The time taken for the app to serve requests, in seconds'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.HttpResponseTime.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 8fc7d39257634589bc2cc4e9d5334a03
          name: 'IO Other Bytes Per Second'
          type: DEPENDENT
          key: azure.wapp.iootherbytespersecond.total
          delay: '0'
          history: 7d
          units: Bps
          description: 'The rate at which the app process is issuing bytes to I/O operations that don''t involve data, such as control operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoOtherBytesPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: 4c4a2f3445c640c78302cef89d1dfd5a
          name: 'IO Other Operations Per Second'
          type: DEPENDENT
          key: azure.wapp.iootheroperationspersecond.total
          delay: '0'
          history: 7d
          units: '!iops'
          description: 'The rate at which the app process is issuing I/O operations that aren''t read or write operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoOtherOperationsPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: 2b86d84af1f3435e81fd19ad3dcf6677
          name: 'IO Read Bytes Per Second'
          type: DEPENDENT
          key: azure.wapp.ioreadbytespersecond.total
          delay: '0'
          history: 7d
          units: Bps
          description: 'The rate at which the app process is reading bytes from I/O operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoReadBytesPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: ddd7e379c7d84bcdb7010b1f54e683ae
          name: 'IO Read Operations Per Second'
          type: DEPENDENT
          key: azure.wapp.ioreadoperationspersecond.total
          delay: '0'
          history: 7d
          units: '!iops'
          description: 'The rate at which the app process is issuing read I/O operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoReadOperationsPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: 628a6edfed5c4e9fa3630930843dc05a
          name: 'IO Write Bytes Per Second'
          type: DEPENDENT
          key: azure.wapp.iowritebytespersecond.total
          delay: '0'
          history: 7d
          units: Bps
          description: 'The rate at which the app process is writing bytes to I/O operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoWriteBytesPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: 9109209e645344a3820a7298f66fcc27
          name: 'IO Write Operations Per Second'
          type: DEPENDENT
          key: azure.wapp.iowriteoperationspersecond.total
          delay: '0'
          history: 7d
          units: '!iops'
          description: 'The rate at which the app process is issuing write I/O operations'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.IoWriteOperationsPerSecond.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: iops
        - uuid: 7e5b938ad2ac400a92327853643e93f6
          name: 'Memory working set'
          type: DEPENDENT
          key: azure.wapp.memoryworkingset.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          units: B
          description: 'The current amount of memory used by the app, in MiB'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.MemoryWorkingSet.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: memory
        - uuid: b22a01991b2e42789dbcbc88f812e05f
          name: 'Private Bytes - Memory'
          type: DEPENDENT
          key: azure.wapp.privatebytes.average
          delay: '0'
          history: 7d
          units: B
          description: 'Private Bytes is the current size, in bytes, of memory that the app process has allocated that can''t be shared with other processes'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.PrivateBytes.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: memory
        - uuid: e2239afa397a490dbc40c8b771c38cdf
          name: 'Number of HTTP Requests'
          type: DEPENDENT
          key: azure.wapp.requests.total
          delay: '0'
          history: 7d
          description: 'The total number of requests regardless of their resulting HTTP status code'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Requests.total
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
            - tag: component
              value: 'http request'
        - uuid: c5e3d35c948b4c8291cadc7cbbdf4cc9
          name: 'Requests In Application Queue'
          type: DEPENDENT
          key: azure.wapp.requestsinapplicationqueue.average
          delay: '0'
          history: 7d
          description: 'The number of requests in the application request queue'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.RequestsInApplicationQueue.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 6b7b36cec82c4ef38a7bc8326f6f8624
          name: 'Thread Count'
          type: DEPENDENT
          key: azure.wapp.threads.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The number of threads currently active in the app process'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.Threads.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: application
        - uuid: 63a9dc9bcfc24d41879561f4053f63c2
          name: 'Total App Domains'
          type: DEPENDENT
          key: azure.wapp.totalappdomains.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The current number of AppDomains loaded in this application'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.TotalAppDomains.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'app domain'
        - uuid: c032cc93862e4721a82186a2bae91d6f
          name: 'Total App Domains Unloaded'
          type: DEPENDENT
          key: azure.wapp.totalappdomainsunloaded.average
          delay: '0'
          history: 7d
          value_type: FLOAT
          description: 'The total number of AppDomains unloaded since the start of the application'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metrics.TotalAppDomainsUnloaded.average
              error_handler: DISCARD_VALUE
          master_item:
            key: azure.wapp.data.get
          tags:
            - tag: component
              value: 'app domain'
      tags:
        - tag: datasource
          value: azure
        - tag: resource
          value: 'web app'
        - tag: type
          value: http
        - tag: version
          value: '3'
      macros:
        - macro: '{$AZURE.APP.ID}'
          description: 'The App ID of Microsoft Azure.'
        - macro: '{$AZURE.DATA.TIMEOUT}'
          value: 30s
          description: 'A response timeout for API.'
        - macro: '{$AZURE.PASSWORD}'
          description: 'Microsoft Azure password.'
        - macro: '{$AZURE.PROXY}'
          description: 'Sets HTTP proxy value. If this macro is empty then no proxy is used.'
        - macro: '{$AZURE.RESOURCE.ID}'
          description: 'Microsoft Azure virtual machine ID.'
        - macro: '{$AZURE.SUBSCRIPTION.ID}'
          description: 'Microsoft Azure subscription ID.'
        - macro: '{$AZURE.TENANT.ID}'
          description: 'Microsoft Azure tenant ID.'
        - macro: '{$WAPP_CPU}'
          value: '90'
        - macro: '{$WAPP_ERRORS}'
          value: '100'
          description: 'Number of HTTP 500 requests'
      valuemaps:
        - uuid: 1259a67d2a6641dca69a9bb20936f825
          name: 'Azure resource health state'
          mappings:
            - value: '0'
              newvalue: Available
            - value: '1'
              newvalue: Degraded
            - value: '2'
              newvalue: Unavailable
            - value: '3'
              newvalue: Unknown
